{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React, { useEffect } from 'react';\nimport styles from './styles.module.css';\n\nimport axios from 'axios';\nimport url from 'url';\nimport qs from 'qs';\nimport querystring from 'querystring';\nimport jwt from 'jsonwebtoken';\n\nconst maxAge = 120;\n\nexport const LineLogin = ({\n  clientID,\n  clientSecret,\n  state,\n  nonce,\n  scope,\n  setPayload,\n  setIdToken,\n  redirectURI\n}) => {\n  const lineLogin = () => {\n    // Build query string.\n    const query = querystring.stringify({\n      response_type: 'code',\n      client_id: clientID,\n      state: state,\n      scope: scope,\n      nonce: nonce,\n      prompt: 'consent',\n      max_age: maxAge,\n      bot_prompt: 'normal'\n    });\n    // Build the Line authorise URL.\n    const lineAuthoriseURL =\n      'https://access.line.me/oauth2/v2.1/authorize?' +\n      query +\n      '&redirect_uri=' +\n      redirectURI;\n    // Redirect to external URL.\n    window.location.href = lineAuthoriseURL;\n  };\n\n  const getAccessToken = (callbackURL) => {\n    var urlParts = url.parse(callbackURL, true);\n    var query = urlParts.query;\n    var hasCodeProperty = Object.prototype.hasOwnProperty.call(query, 'code');\n    if (hasCodeProperty) {\n      const reqBody = {\n        grant_type: 'authorization_code',\n        code: query.code,\n        redirect_uri: redirectURI,\n        client_id: clientID,\n        client_secret: clientSecret\n      };\n      const reqConfig = {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      };\n\n      axios\n        .post(\n          'https://api.line.me/oauth2/v2.1/token',\n          qs.stringify(reqBody),\n          reqConfig\n        )\n        .then((res) => {\n          if (setPayload) setPayload(res.data);\n\n          try {\n            const decodedIdToken = jwt.verify(res.data.id_token, clientSecret, {\n              algorithms: ['HS256'],\n              audience: clientID.toString(),\n              issuer: 'https://access.line.me',\n              nonce: nonce\n            });\n\n            if (setIdToken) setIdToken(decodedIdToken);\n          } catch (err) {\n            // If token is invalid.\n            console.log(err);\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  };\n\n  useEffect(() => {\n    getAccessToken(window.location.href);\n  }, [clientID]);\n\n  return (\n    <div className={styles.App}>\n      <div onClick={() => lineLogin()} className={styles.lineButton} />\n    </div>\n  );\n};\n"],"names":["maxAge","LineLogin","clientID","clientSecret","state","nonce","scope","setPayload","setIdToken","redirectURI","lineLogin","query","querystring","stringify","response_type","client_id","prompt","max_age","bot_prompt","lineAuthoriseURL","window","location","href","getAccessToken","callbackURL","urlParts","url","parse","hasCodeProperty","Object","prototype","hasOwnProperty","call","reqBody","grant_type","code","redirect_uri","client_secret","reqConfig","headers","axios","post","qs","then","res","data","decodedIdToken","jwt","verify","id_token","algorithms","audience","toString","issuer","err","console","log","useEffect","React","styles","App","lineButton"],"mappings":";;;;;;;;;;;;AASA,IAAMA,MAAM,GAAG,GAAf;AAEA,IAAaC,SAAS,GAAG,SAAZA,SAAY,OASnB;AAAA,MARJC,QAQI,QARJA,QAQI;AAAA,MAPJC,YAOI,QAPJA,YAOI;AAAA,MANJC,KAMI,QANJA,KAMI;AAAA,MALJC,KAKI,QALJA,KAKI;AAAA,MAJJC,KAII,QAJJA,KAII;AAAA,MAHJC,UAGI,QAHJA,UAGI;AAAA,MAFJC,UAEI,QAFJA,UAEI;AAAA,MADJC,WACI,QADJA,WACI;;AACJ,MAAMC,SAAS,GAAG,SAAZA,SAAY,GAAM;AAEtB,QAAMC,KAAK,GAAGC,WAAW,CAACC,SAAZ,CAAsB;AAClCC,MAAAA,aAAa,EAAE,MADmB;AAElCC,MAAAA,SAAS,EAAEb,QAFuB;AAGlCE,MAAAA,KAAK,EAAEA,KAH2B;AAIlCE,MAAAA,KAAK,EAAEA,KAJ2B;AAKlCD,MAAAA,KAAK,EAAEA,KAL2B;AAMlCW,MAAAA,MAAM,EAAE,SAN0B;AAOlCC,MAAAA,OAAO,EAAEjB,MAPyB;AAQlCkB,MAAAA,UAAU,EAAE;AARsB,KAAtB,CAAd;AAWA,QAAMC,gBAAgB,GACpB,kDACAR,KADA,GAEA,gBAFA,GAGAF,WAJF;AAMAW,IAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuBH,gBAAvB;AACD,GApBD;;AAsBA,MAAMI,cAAc,GAAG,SAAjBA,cAAiB,CAACC,WAAD,EAAiB;AACtC,QAAIC,QAAQ,GAAGC,GAAG,CAACC,KAAJ,CAAUH,WAAV,EAAuB,IAAvB,CAAf;AACA,QAAIb,KAAK,GAAGc,QAAQ,CAACd,KAArB;AACA,QAAIiB,eAAe,GAAGC,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCrB,KAArC,EAA4C,MAA5C,CAAtB;;AACA,QAAIiB,eAAJ,EAAqB;AACnB,UAAMK,OAAO,GAAG;AACdC,QAAAA,UAAU,EAAE,oBADE;AAEdC,QAAAA,IAAI,EAAExB,KAAK,CAACwB,IAFE;AAGdC,QAAAA,YAAY,EAAE3B,WAHA;AAIdM,QAAAA,SAAS,EAAEb,QAJG;AAKdmC,QAAAA,aAAa,EAAElC;AALD,OAAhB;AAOA,UAAMmC,SAAS,GAAG;AAChBC,QAAAA,OAAO,EAAE;AACP,0BAAgB;AADT;AADO,OAAlB;AAMAC,MAAAA,KAAK,CACFC,IADH,CAEI,uCAFJ,EAGIC,EAAE,CAAC7B,SAAH,CAAaoB,OAAb,CAHJ,EAIIK,SAJJ,EAMGK,IANH,CAMQ,UAACC,GAAD,EAAS;AACb,YAAIrC,UAAJ,EAAgBA,UAAU,CAACqC,GAAG,CAACC,IAAL,CAAV;;AAEhB,YAAI;AACF,cAAMC,cAAc,GAAGC,GAAG,CAACC,MAAJ,CAAWJ,GAAG,CAACC,IAAJ,CAASI,QAApB,EAA8B9C,YAA9B,EAA4C;AACjE+C,YAAAA,UAAU,EAAE,CAAC,OAAD,CADqD;AAEjEC,YAAAA,QAAQ,EAAEjD,QAAQ,CAACkD,QAAT,EAFuD;AAGjEC,YAAAA,MAAM,EAAE,wBAHyD;AAIjEhD,YAAAA,KAAK,EAAEA;AAJ0D,WAA5C,CAAvB;AAOA,cAAIG,UAAJ,EAAgBA,UAAU,CAACsC,cAAD,CAAV;AACjB,SATD,CASE,OAAOQ,GAAP,EAAY;AAEZC,UAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;AACF,OAtBH,WAuBS,UAACA,GAAD,EAAS;AACdC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,OAzBH;AA0BD;AACF,GA7CD;;AA+CAG,EAAAA,eAAS,CAAC,YAAM;AACdlC,IAAAA,cAAc,CAACH,MAAM,CAACC,QAAP,CAAgBC,IAAjB,CAAd;AACD,GAFQ,EAEN,CAACpB,QAAD,CAFM,CAAT;AAIA,sBACEwD;AAAK,IAAA,SAAS,EAAEC,MAAM,CAACC;AAAvB,kBACEF;AAAK,IAAA,OAAO,EAAE;AAAA,aAAMhD,SAAS,EAAf;AAAA,KAAd;AAAiC,IAAA,SAAS,EAAEiD,MAAM,CAACE;AAAnD,IADF,CADF;AAKD,CAxFM;;;;"}