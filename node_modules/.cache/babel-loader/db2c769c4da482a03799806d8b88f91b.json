{"ast":null,"code":"import React, { useEffect } from 'react';\nimport axios from 'axios';\nimport url from 'url';\nimport qs from 'qs';\nimport querystring from 'querystring';\nimport jwt from 'jsonwebtoken';\nvar styles = {\n  \"App\": \"_1RLww\",\n  \"lineButton\": \"_RU-K2\"\n};\nvar maxAge = 120;\n\nvar LineLogin = function LineLogin(_ref) {\n  var clientID = _ref.clientID,\n      clientSecret = _ref.clientSecret,\n      state = _ref.state,\n      nonce = _ref.nonce,\n      scope = _ref.scope,\n      setPayload = _ref.setPayload,\n      setIdToken = _ref.setIdToken,\n      redirectURI = _ref.redirectURI;\n\n  var lineLogin = function lineLogin() {\n    var query = querystring.stringify({\n      response_type: 'code',\n      client_id: clientID,\n      state: state,\n      scope: scope,\n      nonce: nonce,\n      prompt: 'consent',\n      max_age: maxAge,\n      bot_prompt: 'normal'\n    });\n    var lineAuthoriseURL = 'https://access.line.me/oauth2/v2.1/authorize?' + query + '&redirect_uri=' + redirectURI;\n    window.location.href = lineAuthoriseURL;\n  };\n\n  var getAccessToken = function getAccessToken(callbackURL) {\n    var urlParts = url.parse(callbackURL, true);\n    var query = urlParts.query;\n    var hasCodeProperty = Object.prototype.hasOwnProperty.call(query, 'code');\n\n    if (hasCodeProperty) {\n      var reqBody = {\n        grant_type: 'authorization_code',\n        code: query.code,\n        redirect_uri: redirectURI,\n        client_id: clientID,\n        client_secret: clientSecret\n      };\n      var reqConfig = {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      };\n      axios.post('https://api.line.me/oauth2/v2.1/token', qs.stringify(reqBody), reqConfig).then(function (res) {\n        if (setPayload) setPayload(res.data);\n\n        try {\n          var decodedIdToken = jwt.verify(res.data.id_token, clientSecret, {\n            algorithms: ['HS256'],\n            audience: clientID.toString(),\n            issuer: 'https://access.line.me',\n            nonce: nonce\n          });\n          if (setIdToken) setIdToken(decodedIdToken);\n        } catch (err) {\n          console.log(err);\n        }\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    }\n  };\n\n  useEffect(function () {\n    getAccessToken(window.location.href);\n  }, [clientID]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.App\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    onClick: function onClick() {\n      return lineLogin();\n    },\n    className: styles.lineButton\n  }));\n};\n\nexport { LineLogin };","map":{"version":3,"sources":["../src/index.js"],"names":["maxAge","LineLogin","clientID","clientSecret","state","nonce","scope","setPayload","setIdToken","redirectURI","lineLogin","query","response_type","client_id","prompt","max_age","bot_prompt","lineAuthoriseURL","window","getAccessToken","urlParts","url","hasCodeProperty","Object","reqBody","grant_type","code","redirect_uri","client_secret","reqConfig","headers","axios","qs","res","decodedIdToken","algorithms","audience","issuer","console","useEffect","styles","App","lineButton"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport styles from './styles.module.css';\n\nimport axios from 'axios';\nimport url from 'url';\nimport qs from 'qs';\nimport querystring from 'querystring';\nimport jwt from 'jsonwebtoken';\n\nconst maxAge = 120;\n\nexport const LineLogin = ({\n  clientID,\n  clientSecret,\n  state,\n  nonce,\n  scope,\n  setPayload,\n  setIdToken,\n  redirectURI\n}) => {\n  const lineLogin = () => {\n    // Build query string.\n    const query = querystring.stringify({\n      response_type: 'code',\n      client_id: clientID,\n      state: state,\n      scope: scope,\n      nonce: nonce,\n      prompt: 'consent',\n      max_age: maxAge,\n      bot_prompt: 'normal'\n    });\n    // Build the Line authorise URL.\n    const lineAuthoriseURL =\n      'https://access.line.me/oauth2/v2.1/authorize?' +\n      query +\n      '&redirect_uri=' +\n      redirectURI;\n    // Redirect to external URL.\n    window.location.href = lineAuthoriseURL;\n  };\n\n  const getAccessToken = (callbackURL) => {\n    var urlParts = url.parse(callbackURL, true);\n    var query = urlParts.query;\n    var hasCodeProperty = Object.prototype.hasOwnProperty.call(query, 'code');\n    if (hasCodeProperty) {\n      const reqBody = {\n        grant_type: 'authorization_code',\n        code: query.code,\n        redirect_uri: redirectURI,\n        client_id: clientID,\n        client_secret: clientSecret\n      };\n      const reqConfig = {\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      };\n\n      axios\n        .post(\n          'https://api.line.me/oauth2/v2.1/token',\n          qs.stringify(reqBody),\n          reqConfig\n        )\n        .then((res) => {\n          if (setPayload) setPayload(res.data);\n\n          try {\n            const decodedIdToken = jwt.verify(res.data.id_token, clientSecret, {\n              algorithms: ['HS256'],\n              audience: clientID.toString(),\n              issuer: 'https://access.line.me',\n              nonce: nonce\n            });\n\n            if (setIdToken) setIdToken(decodedIdToken);\n          } catch (err) {\n            // If token is invalid.\n            console.log(err);\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  };\n\n  useEffect(() => {\n    getAccessToken(window.location.href);\n  }, [clientID]);\n\n  return (\n    <div className={styles.App}>\n      <div onClick={() => lineLogin()} className={styles.lineButton} />\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}